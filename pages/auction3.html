<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXCQ Protected Note Auction - 150% Yield Boost | 50% Protection</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/enhanced-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <style>
        /* Main layout structure */
        .auction-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .auction-header {
            margin-bottom: 1.5rem;
        }
        
        .auction-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .auction-subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .auction-subtitle span {
            background-color: #f8f9fa;
            padding: 6px 12px;
            border-radius: 6px;
            white-space: nowrap;
        }
        
        .auction-subtitle strong {
            color: var(--text-primary, #333);
        }
        
        /* Three-panel layout */
        .auction-panels {
            display: flex;
            gap: 1.5rem;
            min-height: 700px;
        }
        
        /* Left Panel (30% width) */
        .left-panel {
            flex: 3;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Center Panel (50% width) */
        .center-panel {
            flex: 5;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Right Panel (20% width) */
        .right-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Panel card styling */
        .panel-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1.25rem;
        }
        
        .panel-card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* User Portfolio */
        .portfolio-card {
            margin-bottom: 0;
        }
        
        .portfolio-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        .portfolio-summary-item {
            width: calc(50% - 0.375rem);
            padding: 0.5rem;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        
        .portfolio-summary-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .portfolio-summary-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .portfolio-pnl {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .portfolio-pnl.positive {
            color: #28a745;
        }
        
        .portfolio-pnl.negative {
            color: #dc3545;
        }
        
        /* Protection threshold visualization */
        .protection-container {
            margin-top: 1rem;
        }
        
        .protection-bar, .protection-meter {
            height: 12px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin: 2.5rem 0 1.5rem;
            position: relative;
            overflow: visible;
        }
        
        .protection-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            width: 50%;
        }
        
        .protection-threshold {
            position: absolute;
            left: 50%;
            top: -25px;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            z-index: 5; /* Add z-index to ensure labels appear above other elements */
        }
        
        /* Add specific styles for edge labels to prevent overflow */
        .protection-threshold.edge-left {
            left: 5px;
            transform: none;
        }
        
        .protection-threshold.edge-right {
            left: auto;
            right: 5px;
            transform: none;
        }
        
        .protection-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 10px;
            padding: 0 5px; /* Add padding to align with the edge labels */
        }
        
        /* Update the protection-status class to add padding */
        .protection-status {
            padding-top: 10px;
            padding-bottom: 10px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .quick-action-btn {
            padding: 0.6rem 1rem;
            border-radius: 6px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .quick-action-btn:hover {
            background-color: #e9ecef;
        }
        
        .quick-action-btn .icon {
            margin: 0;
        }
        
        /* Auction Progress Timeline */
        .timeline-container {
            margin: 1.5rem 0;
        }
        
        .timeline {
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 1;
        }
        
        .timeline-step {
            position: relative;
            z-index: 2;
            text-align: center;
            cursor: pointer;
        }
        
        .timeline-point {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 auto 0.5rem;
        }
        
        .timeline-point.completed {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .timeline-point.active {
            background-color: white;
            color: var(--primary);
            border-color: var(--primary);
            border-width: 3px;
        }
        
        .timeline-label {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .timeline-sublabel {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* Add styles for tokens sold and trigger status */
        .timeline-tokens-sold {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        .timeline-trigger {
            font-size: 0.8rem;
            margin-top: 0.25rem;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .timeline-trigger.triggered {
            background-color: #28a745;
            color: white;
        }
        
        .timeline-trigger.not-triggered {
            background-color: #dc3545;
            color: white;
        }
        
        /* Countdown clock */
        .countdown-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 1rem 0;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .countdown-timer {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .countdown-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        /* Transaction History */
        .transaction-list {
            overflow-y: auto;
            max-height: 400px;
        }
        
        .transaction-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-details {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .transaction-price {
            font-weight: 600;
        }
        
        .transaction-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .transaction-amount {
            font-weight: 500;
            color: var(--primary);
        }
        
        /* Transaction filter styles */
        .transaction-filter {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .filter-btn {
            padding: 0.4rem 0.75rem;
            border-radius: 4px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-btn.active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: #000;
        }
        
        /* Compliance Disclosures */
        .compliance-toggle {
            margin-top: 1rem;
        }
        
        .compliance-title {
            cursor: pointer;
            padding: 0.5rem 0;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
        }
        
        .compliance-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-color);
        }
        
        /* Bid form styles */
        .bid-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        
        .bid-tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .bid-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        
        .bid-tab:hover:not(.active) {
            background-color: #f8f9fa;
            border-bottom-color: #e9ecef;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form styling */
        .bid-form {
            margin-top: 1rem;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .form-group input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background-color: #fff;
        }
        
        .form-group input[type="number"]:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(246, 209, 49, 0.2);
            outline: none;
        }
        
        .price-range {
            display: flex;
            gap: 1rem;
        }
        
        .price-range input {
            flex: 1;
        }
        
        .submit-btn {
            width: 100%;
            padding: 0.9rem;
            background-color: var(--primary);
            color: #000;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .submit-btn:hover {
            background-color: #e5c32c;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .submit-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Estimate box styling */
        .estimate-box {
            background-color: #f8f9fa;
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }
        
        .estimate-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }
        
        .estimate-row:last-of-type {
            margin-bottom: 0;
        }
        
        .estimate-total {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            padding-top: 0.75rem;
            margin-top: 0.5rem;
            border-top: 1px solid var(--border-color);
            font-size: 1.05rem;
        }
        
        /* Early bid discount alert */
        .early-bid-alert {
            background-color: rgba(246, 209, 49, 0.15);
            border-left: 3px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1.25rem;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .early-bid-alert .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .early-bid-alert .alert-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .early-bid-alert .alert-timer {
            font-weight: 600;
        }
        
        .early-bid-alert .alert-savings {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .auction-panels {
                flex-direction: column;
            }
            
            .left-panel, .center-panel, .right-panel {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .price-info {
                grid-template-columns: 1fr;
            }
            
            .portfolio-summary-item {
                width: 100%;
            }
        }
        
        /* Icons */
        .icon {
            width: 18px;
            height: 18px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Header Component -->
    <site-header></site-header>

    <main class="auction-container">
        <div class="auction-header">
            <h1 class="auction-title">EXCQ Protected Note Auction - 150% Yield Boost | 50% Protection</h1>

            <p class="auction-subtitle">
                <span><strong>Maturity:</strong> Dec 15, 2023</span>
                <span><strong>Auction:</strong> Round 3 of 6</span>
                <span><strong>Reserve Bank:</strong> 25,000 tokens</span>
                <span><strong>Prior Round Tokens:</strong> 18,500 tokens</span>
                <span><strong>Total Round Volume:</strong> 112,000 tokens</span>
                <span><strong>Time Remaining:</strong> <span id="subtitle-countdown">05:23:47</span></span>
            </p>
        
        <!-- Three-panel layout structure -->
        <div class="auction-panels">
            <!-- Left Panel (30% width) -->
            <section class="left-panel">
                <!-- User Portfolio -->
                <div class="panel-card">
                    <div class="panel-card-title">
                        <span>Your Portfolio</span>
                    </div>
                    <div class="portfolio-summary">
                        <div class="portfolio-summary-item">
                            <div class="portfolio-summary-label">Total Tokens</div>
                            <div class="portfolio-summary-value">3,000</div>
                        </div>
                        <div class="portfolio-summary-item">
                            <div class="portfolio-summary-label">Average Price</div>
                            <div class="portfolio-summary-value">$1.41</div>
                        </div>
                        <div class="portfolio-summary-item">
                            <div class="portfolio-summary-label">Current Value</div>
                            <div class="portfolio-summary-value">$4,350</div>
                        </div>
                        <div class="portfolio-summary-item">
                            <div class="portfolio-summary-label">Profit/Loss</div>
                            <div class="portfolio-pnl positive">+$1,120 (+34.7%)</div>
                        </div>
                    </div>
                </div>

                <!-- Protection Status -->
                <div class="panel-card">
                    <div class="panel-card-title">
                        <span>Price Status</span>
                    </div>
                    <div class="protection-status">
                        <!-- Add a description text to explain the price status -->
                        <div class="protection-description" style="margin-bottom: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                            Current price is $1.75. Trigger activates at $1.85, reserve price is $1.50.
                        </div>
                        <div class="protection-bar">
                            <div class="protection-fill" style="width: 71.4%; background: linear-gradient(to right, #28a745, #f6d131);"></div>
                            <div class="protection-threshold edge-right" style="top: 20px;">Trigger: $1.85</div>
                            <div class="protection-threshold edge-left" style="top: 20px;">Reserve: $1.50</div>
                            <div class="protection-threshold" style="left: 71.4%; top: -25px; color: #333;">Current: $1.75</div>
                            <div class="current-price-marker" style="position: absolute; left: 71.4%; top: -6px; width: 4px; height: 24px; background-color: #333; transform: translateX(-50%);"></div>
                        </div>
                        <div class="protection-labels" style="margin-top: 30px;">
                            <span>$1.50</span>
                            <span>$1.85</span>
                        </div>
                        <div style="text-align: center; margin-top: 15px; font-size: 0.85rem; color: var(--text-secondary);">
                            <span style="color: #28a745; font-weight: 600;">$0.25</span> above reserve, 
                            <span style="color: #dc3545; font-weight: 600;">$0.10</span> below trigger
                        </div>
                    </div>
                </div>
            </section>

            <!-- Center Panel (50% width) -->
            <section class="center-panel">
                <!-- Participation Options -->
                <div class="panel-card">
                    <div class="panel-card-title">
                        <span>Participation Options</span>
                    </div>
                    
                    <!-- Tab Navigation -->
                    <div class="bid-tabs">
                        <div class="bid-tab active" data-tab="simple-bid">Simple Bid</div>
                        <div class="bid-tab" data-tab="advanced-bid">Advanced Bid</div>
                        <div class="bid-tab" data-tab="sell-tokens">Sell Tokens</div>
                    </div>
                    
                    <!-- Simple Bid Content -->
                    <div class="tab-content active" id="simple-bid-content">
                        <!-- Early Bid Discount Alert -->
                        <div class="early-bid-alert">
                            <div>
                                <div class="alert-title">Early Bid Discount: 5%</div>
                                <div class="alert-description">Place your bid within <span id="simple-discount-timer" class="alert-timer">03:45:12</span> to receive the discount</div>
                            </div>
                            <div class="alert-savings">Save up to $125</div>
                        </div>
                        
                        <div class="bid-form">
                            <div class="form-group">
                                <label>Bid Amount ($)</label>
                                <input type="number" id="simple-bid-amount" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label>Maximum Price per Token ($)</label>
                                <input type="number" id="simple-max-price" value="1.60">
                            </div>
                            
                            <!-- Estimated Tokens Box -->
                            <div class="estimate-box">
                                <div class="estimate-row">
                                    <span>Estimated Tokens</span>
                                    <span id="simple-estimated-tokens">0</span>
                                </div>
                                <div class="estimate-row">
                                    <span>Early Bid Discount</span>
                                    <span id="simple-discount">$0.00</span>
                                </div>
                                <div class="estimate-total">
                                    <span>Total Bid</span>
                                    <span id="simple-total">$0.00</span>
                                </div>
                            </div>
                            
                            <button class="submit-btn" id="simple-bid-submit">Place Bid</button>
                        </div>
                    </div>
                    
                    <!-- Advanced Bid Content -->
                    <div class="tab-content" id="advanced-bid-content">
                        <!-- Early Bid Discount Alert -->
                        <div class="early-bid-alert">
                            <div>
                                <div class="alert-title">Early Bid Discount: 5%</div>
                                <div class="alert-description">Place your bid within <span id="advanced-discount-timer" class="alert-timer">03:45:12</span> to receive the discount</div>
                            </div>
                            <div class="alert-savings">Save up to $125</div>
                        </div>
                        
                        <div class="bid-form">
                            <div class="form-group">
                                <label>Token Amount</label>
                                <input type="number" id="advanced-token-amount" placeholder="Enter token amount">
                            </div>
                            <div class="form-group">
                                <label>Price Range ($)</label>
                                <div class="price-range">
                                    <input type="number" id="min-price" placeholder="Min">
                                    <input type="number" id="max-price" placeholder="Max">
                                </div>
                            </div>
                            
                            <!-- Estimated Tokens Box -->
                            <div class="estimate-box">
                                <div class="estimate-row">
                                    <span>Total Bid Amount</span>
                                    <span id="adv-total-amount">$0.00</span>
                                </div>
                                <div class="estimate-row">
                                    <span>Early Bid Discount</span>
                                    <span id="adv-discount">$0.00</span>
                                </div>
                                <div class="estimate-row">
                                    <span>Success Probability</span>
                                    <span id="adv-probability">N/A</span>
                                </div>
                                <div class="estimate-total">
                                    <span>Final Amount</span>
                                    <span id="adv-final-amount">$0.00</span>
                                </div>
                            </div>
                            
                            <button class="submit-btn" id="advanced-bid-submit">Place Advanced Bid</button>
                        </div>
                    </div>
                    
                    <!-- Sell Tokens Content -->
                    <div class="tab-content" id="sell-tokens-content">
                        <div class="bid-form">
                            <div class="form-group">
                                <label>Token Amount to Sell</label>
                                <input type="number" id="sell-token-amount" placeholder="Enter amount to sell">
                            </div>
                            <div class="form-group">
                                <label>Minimum Price per Token ($)</label>
                                <input type="number" id="sell-min-price" value="1.40">
                            </div>
                            
                            <!-- Preview Box for Sell Tokens -->
                            <div class="estimate-box">
                                <div class="estimate-row">
                                    <span>Tokens to Sell</span>
                                    <span id="sell-tokens-preview">0</span>
                                </div>
                                <div class="estimate-row">
                                    <span>Minimum Sale Price</span>
                                    <span id="sell-price-preview">$1.40</span>
                                </div>
                                <div class="estimate-row">
                                    <span>Your Average Cost</span>
                                    <span id="sell-avg-cost">$1.41</span>
                                </div>
                                <div class="estimate-row">
                                    <span>Profit/Loss per Token</span>
                                    <span id="sell-pnl-per-token">$0.00</span>
                                </div>
                                <div class="estimate-total">
                                    <span>Total Sale Amount</span>
                                    <span id="sell-total-amount">$0.00</span>
                                </div>
                                <div class="estimate-total" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: none;">
                                    <span>Total P&L</span>
                                    <span id="sell-total-pnl">$0.00</span>
                                </div>
                            </div>
                            
                            <button class="submit-btn" id="sell-tokens-submit">Sell Tokens</button>
                        </div>
                    </div>
                </div>

                <!-- Auction Progress Timeline -->
                <div class="panel-card">
                    <div class="panel-card-title">
                        <span>Auction Progress Timeline</span>
                    </div>
                    <div class="timeline-container">
                        <div class="timeline">
                            <div class="timeline-step" data-round="1">
                                <div class="timeline-point completed">1</div>
                                <div class="timeline-label">Round 1</div>
                                <div class="timeline-sublabel">$1.33</div>
                                <div class="timeline-tokens-sold">100,000 tokens</div>
                                <div class="timeline-trigger triggered">Triggered</div>
                            </div>
                            <div class="timeline-step" data-round="2">
                                <div class="timeline-point completed">2</div>
                                <div class="timeline-label">Round 2</div>
                                <div class="timeline-sublabel">$1.85</div>
                                <div class="timeline-tokens-sold">90,000 tokens</div>
                                <div class="timeline-trigger not-triggered">Not Triggered</div>
                            </div>
                            <div class="timeline-step" data-round="3">
                                <div class="timeline-point active">3</div>
                                <div class="timeline-label">Round 3</div>
                                <div class="timeline-sublabel">Active</div>
                                <div class="timeline-tokens-sold">45,000 tokens so far</div>
                                <div class="timeline-trigger not-triggered">Not Triggered</div>
                            </div>
                            <div class="timeline-step" data-round="4">
                                <div class="timeline-point">4</div>
                                <div class="timeline-label">Round 4</div>
                                <div class="timeline-sublabel">Upcoming</div>
                                <div class="timeline-tokens-sold">0 tokens</div>
                                <div class="timeline-trigger">Pending</div>
                            </div>
                            <div class="timeline-step" data-round="5">
                                <div class="timeline-point">5</div>
                                <div class="timeline-label">Round 5</div>
                                <div class="timeline-sublabel">Upcoming</div>
                                <div class="timeline-tokens-sold">0 tokens</div>
                                <div class="timeline-trigger">Pending</div>
                            </div>
                            <div class="timeline-step" data-round="6">
                                <div class="timeline-point">6</div>
                                <div class="timeline-label">Round 6</div>
                                <div class="timeline-sublabel">Upcoming</div>
                                <div class="timeline-tokens-sold">0 tokens</div>
                                <div class="timeline-trigger">Pending</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Round Details -->
                <div class="panel-card">
                    <div class="panel-card-title">
                        <span>Round 3 Details</span>
                        <span>112,000 tokens available</span>
                    </div>
                    
                    <!-- Price curve chart -->
                    <div style="height: 300px; margin-bottom: 2rem;">
                        <canvas id="priceCurveChart"></canvas>
                    </div>
                    
                    <!-- Bid volume heatmap -->
                    <div>
                        <div class="panel-card-title">
                            <span>Current Bidding Activity</span>
                            <span style="font-size: 0.8rem; font-weight: normal; color: var(--text-secondary);">Distribution of bids across price ranges</span>
                        </div>
                        <div style="height: 250px; margin-bottom: 1rem;">
                            <canvas id="bidHeatmapChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Countdown clock -->
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--primary);" id="round-countdown"></div>
                    </div>
                </div>
            </section>

            <!-- Right Panel (20% width) -->
            <section class="right-panel">
                <!-- Transaction History -->
                <div class="panel-card">
                    <div class="panel-card-title">
                        <span>Transaction History</span>
                        <span>312 bids total</span>
                    </div>
                    
                    <!-- Transaction filters -->
                    <div class="transaction-filter">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="my-bids">My Bids</button>
                        <button class="filter-btn" data-filter="recent">Recent</button>
                        <button class="filter-btn" data-filter="won">Won</button>
                    </div>
                    
                    <!-- Transaction list -->
                    <div class="transaction-list" id="transaction-list">
                        <!-- Transactions will be dynamically populated -->
                    </div>
                </div>
                
                <!-- Compliance Disclosures -->
                <div class="panel-card">
                    <div class="compliance-toggle">
                        <div class="compliance-title">
                            <span>Auction Rules</span>
                            <span>+</span>
                        </div>
                        <div class="compliance-content" style="display: none;">
                            <p>This is a multi-round uniform price auction where participants can both buy and sell tokens between rounds. Each round establishes a single clearing price for all successful bids. The auction includes 6 rounds with protection mechanisms to maintain price stability.</p>
                            <p>Key features:</p>
                            <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                <li>Uniform pricing - all successful bids in a round receive the same price</li>
                                <li>Inter-round trading - ability to sell tokens between rounds</li>
                                <li>50% price protection - downside protection mechanism</li>
                                <li>Early bid discounts - 5% discount for early participation</li>
                            </ul>
                            <p style="margin-top: 0.75rem;"><a href="/documents/auction-rules.pdf" style="color: var(--primary); text-decoration: underline; font-weight: 500;">View Full Auction Rules Document</a></p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer Component -->
    <site-footer></site-footer>

    <!-- Scripts -->
    <script src="/components/Header.js"></script>
    <script src="/components/Footer.js"></script>
    <script src="/countdown.js"></script>
    <script>
        // Register Chart.js plugins
        console.log('Registering Chart.js plugins');
        
        // Make sure Chart.js is loaded
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded!');
            } else {
                console.log('Chart.js is loaded successfully');
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize transaction history
            const transactions = {
                all: [
                    { price: 1.53, user: 'User0x81...4e', time: '2 min ago', amount: 1200 },
                    { price: 1.49, user: 'User0x72...3a', time: '5 min ago', amount: 850 },
                    { price: 1.62, user: 'User0x44...8b', time: '8 min ago', amount: 2000 },
                    { price: 1.47, user: 'User0x93...5f', time: '12 min ago', amount: 750 },
                    { price: 1.51, user: 'You', time: '18 min ago', amount: 1000 },
                    { price: 1.44, user: 'User0x67...2c', time: '22 min ago', amount: 3200 }
                ],
                'my-bids': [
                    { price: 1.51, user: 'You', time: '18 min ago', amount: 1000 },
                    { price: 1.48, user: 'You', time: '1 hour ago', amount: 500 },
                    { price: 1.45, user: 'You', time: '2 hours ago', amount: 750 }
                ],
                recent: [
                    { price: 1.53, user: 'User0x81...4e', time: '2 min ago', amount: 1200 },
                    { price: 1.49, user: 'User0x72...3a', time: '5 min ago', amount: 850 },
                    { price: 1.62, user: 'User0x44...8b', time: '8 min ago', amount: 2000 }
                ],
                won: [
                    { price: 1.45, user: 'You', time: '2 hours ago', amount: 750 },
                    { price: 1.42, user: 'User0x55...9c', time: '3 hours ago', amount: 1500 }
                ]
            };

            function updateTransactionList(filter) {
                const transactionList = document.getElementById('transaction-list');
                transactionList.innerHTML = '';
                
                transactions[filter].forEach(tx => {
                    const txElement = document.createElement('div');
                    txElement.className = 'transaction-item';
                    txElement.innerHTML = `
                        <div class="transaction-details">
                            <div class="transaction-price">$${tx.price.toFixed(2)}</div>
                            <div class="transaction-meta">${tx.user} - ${tx.time}</div>
                        </div>
                        <div class="transaction-amount">${tx.amount} tokens</div>
                    `;
                    transactionList.appendChild(txElement);
                });
            }

            // Transaction filter buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateTransactionList(btn.dataset.filter);
                });
            });

            // Initialize with 'all' transactions
            updateTransactionList('all');

            // Bid tabs functionality
            const bidTabs = document.querySelectorAll('.bid-tab');
            const tabContents = document.querySelectorAll('.tab-content');

            bidTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    bidTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabId = tab.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-content`) {
                            content.classList.add('active');
                        }
                    });
                });
            });

            // Timeline round selection
            const timelineSteps = document.querySelectorAll('.timeline-step');
            timelineSteps.forEach(step => {
                step.addEventListener('click', () => {
                    const round = parseInt(step.getAttribute('data-round'));
                    // Update round details graph here
                    console.log(`Showing details for round ${round}`);
                });
            });

            // Add countdown timer functionality for Round 3
            function updateRoundCountdown() {
                const countdownElement = document.getElementById('round-countdown');
                if (!countdownElement) return;
                
                const countdownText = countdownElement.textContent;
                const [hours, minutes, seconds] = countdownText.split(':').map(Number);
                
                let totalSeconds = hours * 3600 + minutes * 60 + seconds;
                
                if (totalSeconds <= 0) {
                    countdownElement.textContent = "Round Complete";
                    
                    // Update the timeline to show round 3 as completed
                    const round3Step = document.querySelector('.timeline-step[data-round="3"]');
                    if (round3Step) {
                        const round3Point = round3Step.querySelector('.timeline-point');
                        round3Point.classList.remove('active');
                        round3Point.classList.add('completed');
                        
                        const round3Sublabel = round3Step.querySelector('.timeline-sublabel');
                        round3Sublabel.textContent = "$1.65"; // Final price for round 3
                        
                        // Activate round 4
                        const round4Step = document.querySelector('.timeline-step[data-round="4"]');
                        if (round4Step) {
                            const round4Point = round4Step.querySelector('.timeline-point');
                            round4Point.classList.add('active');
                            
                            const round4Sublabel = round4Step.querySelector('.timeline-sublabel');
                            round4Sublabel.textContent = "Active";
                        }
                    }
                    
                    return;
                }
                
                totalSeconds--;
                
                const newHours = Math.floor(totalSeconds / 3600);
                const newMinutes = Math.floor((totalSeconds % 3600) / 60);
                const newSeconds = totalSeconds % 60;
                
                const formattedTime = `${newHours.toString().padStart(2, '0')}:${newMinutes.toString().padStart(2, '0')}:${newSeconds.toString().padStart(2, '0')}`;
                
                countdownElement.textContent = formattedTime;
                
                // Also update the subtitle countdown
                const subtitleCountdown = document.getElementById('subtitle-countdown');
                if (subtitleCountdown) {
                    subtitleCountdown.textContent = formattedTime;
                }
                
                setTimeout(updateRoundCountdown, 1000);
            }

            // Start countdown timer when page loads
            document.addEventListener('DOMContentLoaded', function() {
                updateRoundCountdown();
                
                // Add auction data with trigger mechanism and tokens sold information
                const auctionRoundData = [
                    { 
                        round: 1, 
                        price: 1.33, 
                        status: 'completed', 
                        tokensSold: 100000, 
                        triggerActivated: true 
                    },
                    { 
                        round: 2, 
                        price: 1.85, 
                        status: 'completed', 
                        tokensSold: 90000, 
                        triggerActivated: false 
                    },
                    { 
                        round: 3, 
                        price: 0, // Will be determined at end of round
                        status: 'active', 
                        tokensSold: 45000, 
                        triggerActivated: false 
                    },
                    { 
                        round: 4, 
                        price: 0,
                        status: 'upcoming', 
                        tokensSold: 0, 
                        triggerActivated: false 
                    },
                    { 
                        round: 5, 
                        price: 0,
                        status: 'upcoming', 
                        tokensSold: 0, 
                        triggerActivated: false 
                    },
                    { 
                        round: 6, 
                        price: 0,
                        status: 'upcoming', 
                        tokensSold: 0, 
                        triggerActivated: false 
                    }
                ];
                
                // Create price curve chart for Round 3
                console.log('Initializing price curve chart');
                // Chart initialization moved to separate script
                
                // Function to update the timeline with real-time data
                function updateAuctionTimeline() {
                    auctionRoundData.forEach(roundData => {
                        const roundStep = document.querySelector(`.timeline-step[data-round="${roundData.round}"]`);
                        if (roundStep) {
                            const tokensSoldElement = roundStep.querySelector('.timeline-tokens-sold');
                            if (tokensSoldElement) {
                                tokensSoldElement.textContent = `${roundData.tokensSold.toLocaleString()} tokens`;
                            }
                            
                            // Update trigger status
                            const triggerElement = roundStep.querySelector('.timeline-trigger');
                            if (triggerElement) {
                                if (roundData.status === 'upcoming') {
                                    triggerElement.textContent = 'Pending';
                                    triggerElement.className = 'timeline-trigger';
                                } else {
                                    if (roundData.triggerActivated) {
                                        triggerElement.textContent = 'Triggered';
                                        triggerElement.className = 'timeline-trigger triggered';
                                    } else {
                                        triggerElement.textContent = 'Not Triggered';
                                        triggerElement.className = 'timeline-trigger not-triggered';
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Initial update
                updateAuctionTimeline();
                
                // Simulate real-time updates for Round 3 (for demo purposes)
                setInterval(() => {
                    // Increment tokens sold in round 3 by a random amount
                    const round3Data = auctionRoundData.find(data => data.round === 3);
                    if (round3Data && round3Data.status === 'active') {
                        const randomIncrement = Math.floor(Math.random() * 500) + 100;
                        round3Data.tokensSold += randomIncrement;
                        
                        // Randomly trigger the mechanism with a small probability
                        if (Math.random() < 0.01 && !round3Data.triggerActivated) {
                            round3Data.triggerActivated = true;
                        }
                        
                        updateAuctionTimeline();
                    }
                }, 5000); // Update every 5 seconds
            });

            // Bid submission handlers
            document.getElementById('simple-bid-submit').addEventListener('click', function() {
                const amount = document.getElementById('simple-bid-amount').value;
                const maxPrice = document.getElementById('simple-max-price').value;
                
                // Add new transaction to history
                transactions.all.unshift({
                    price: parseFloat(maxPrice),
                    user: 'You',
                    time: 'Just now',
                    amount: Math.floor(amount / maxPrice)
                });
                transactions['my-bids'].unshift(transactions.all[0]);
                transactions.recent.unshift(transactions.all[0]);
                
                // Update current view
                const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                updateTransactionList(activeFilter);
            });

            document.getElementById('advanced-bid-submit').addEventListener('click', function() {
                const tokenAmount = document.getElementById('advanced-token-amount').value;
                const minPrice = document.getElementById('min-price').value;
                const maxPrice = document.getElementById('max-price').value;
                
                transactions.all.unshift({
                    price: parseFloat(maxPrice),
                    user: 'You',
                    time: 'Just now',
                    amount: parseInt(tokenAmount)
                });
                transactions['my-bids'].unshift(transactions.all[0]);
                transactions.recent.unshift(transactions.all[0]);
                
                const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                updateTransactionList(activeFilter);
            });

            document.getElementById('sell-tokens-submit').addEventListener('click', function() {
                const tokenAmount = document.getElementById('sell-token-amount').value;
                const minPrice = document.getElementById('sell-min-price').value;
                
                // Only proceed if values are valid
                if (parseInt(tokenAmount) > 0 && parseFloat(minPrice) > 0) {
                    // Add new transaction to history
                    transactions.all.unshift({
                        price: parseFloat(minPrice),
                        user: 'You',
                        time: 'Just now',
                        amount: parseInt(tokenAmount)
                    });
                    transactions['my-bids'].unshift(transactions.all[0]);
                    transactions.recent.unshift(transactions.all[0]);
                    
                    // Update current view
                    const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                    updateTransactionList(activeFilter);
                    
                    // Show confirmation message
                    alert(`Sell order placed for ${tokenAmount} tokens at $${minPrice} per token.`);
                    
                    // Reset form
                    document.getElementById('sell-token-amount').value = '';
                    updateSellTokensPreview();
                } else {
                    alert('Please enter valid token amount and price.');
                }
            });

            // Initialize Chart.js graphs for each round
            function initializeRoundGraphs() {
                // Helper function to generate data for shaded areas
                function generateAreaData(startValue, endValue, startIndex, endIndex) {
                    const data = Array(30).fill(null);
                    
                    // Fill in the values between startIndex and endIndex
                    for (let i = startIndex; i <= endIndex; i++) {
                        if (i === startIndex) {
                            data[i] = startValue;
                        } else if (i === endIndex) {
                            data[i] = endValue;
                        } else {
                            // Linear interpolation between start and end values
                            const ratio = (i - startIndex) / (endIndex - startIndex);
                            data[i] = startValue - (startValue - endValue) * ratio;
                        }
                    }
                    
                    return data;
                }
                
                // Round 3 demand graph from auction2.html - exact copy
                const round3Data = {
                    labels: Array.from({length: 30}, (_, i) => i * 10000),
                    datasets: [
                        // Normal allocation
                        {
                            label: 'Normal',
                            data: generateAreaData(3.00, 2.00, 0, 6),
                            backgroundColor: 'rgba(0, 123, 255, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Prior Round allocation
                        {
                            label: 'Prior Round',
                            data: generateAreaData(2.00, 1.85, 6, 8),
                            backgroundColor: 'rgba(255, 193, 7, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Future Round allocation
                        {
                            label: 'Future Round',
                            data: generateAreaData(1.85, 1.75, 8, 10),
                            backgroundColor: 'rgba(40, 167, 69, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Not Cleared allocation
                        {
                            label: 'Not Cleared',
                            data: generateAreaData(1.75, 0.75, 10, 30),
                            backgroundColor: 'rgba(220, 53, 69, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Demand Curve line
                        {
                            label: 'Demand Curve',
                            data: [3.00, 2.80, 2.60, 2.40, 2.20, 2.00, 1.90, 1.85, 1.80, 1.75, 1.70, 1.65, 1.60, 1.55, 1.50, 1.45, 1.40, 1.35, 1.30, 1.25, 1.20, 1.15, 1.10, 1.05, 1.00, 0.95, 0.90, 0.85, 0.80, 0.75],
                            borderColor: 'rgb(220, 53, 69)',
                            borderWidth: 3,
                            tension: 0.1,
                            fill: false
                        },
                        // Add key point markers for Round 3
                        {
                            label: 'Key Price Points',
                            data: [
                                { x: 90000, y: 1.75 },   // Current price at 90,000 tokens
                                { x: 150000, y: 1.50 },  // Reserve price at 150,000 tokens
                                { x: 80000, y: 1.85 }    // Trigger price at 80,000 tokens
                            ],
                            backgroundColor: [
                                'rgba(0, 123, 255, 0.8)',  // Current price (blue)
                                'rgba(40, 167, 69, 0.8)',  // Reserve price (green)
                                'rgba(220, 53, 69, 0.8)'   // Trigger price (red)
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            pointRadius: 10,
                            pointStyle: ['circle', 'triangle', 'rect'],
                            showLine: false,
                            pointHoverRadius: 12,
                            pointHoverBackgroundColor: [
                                'rgba(0, 123, 255, 1)',  // Current price (blue)
                                'rgba(40, 167, 69, 1)',  // Reserve price (green)
                                'rgba(220, 53, 69, 1)'   // Trigger price (red)
                            ],
                            pointHoverBorderColor: '#ffffff',
                            pointHoverBorderWidth: 3
                        }
                    ]
                };

                // Round 1 graph
                const round1Data = {
                    labels: Array.from({length: 30}, (_, i) => i * 10000),
                    datasets: [
                        // Normal allocation
                        {
                            label: 'Normal',
                            data: generateAreaData(2.50, 1.60, 0, 7),
                            backgroundColor: 'rgba(0, 123, 255, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Prior Round allocation
                        {
                            label: 'Prior Round',
                            data: generateAreaData(1.60, 1.45, 7, 9),
                            backgroundColor: 'rgba(255, 193, 7, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Future Round allocation
                        {
                            label: 'Future Round',
                            data: generateAreaData(1.45, 1.33, 9, 11),
                            backgroundColor: 'rgba(40, 167, 69, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Not Cleared allocation
                        {
                            label: 'Not Cleared',
                            data: generateAreaData(1.33, 0.65, 11, 30),
                            backgroundColor: 'rgba(220, 53, 69, 0.5)',
                            borderWidth: 0,
                            fill: true,
                            pointRadius: 0
                        },
                        // Demand Curve line
                        {
                            label: 'Demand Curve',
                            data: [2.50, 2.30, 2.10, 1.95, 1.80, 1.70, 1.60, 1.50, 1.45, 1.40, 1.35, 1.33, 1.30, 1.28, 1.25, 1.22, 1.20, 1.17, 1.15, 1.12, 1.10, 1.05, 1.00, 0.95, 0.90, 0.85, 0.80, 0.75, 0.70, 0.65],
                            borderColor: 'rgb(220, 53, 69)',
                            borderWidth: 3,
                            tension: 0.1,
                            fill: false
                        },
                        // Add key point markers for Round 1
                        {
                            label: 'Key Price Points',
                            data: [
                                { x: 110000, y: 1.33 },  // Current price at 110,000 tokens
                                { x: 220000, y: 1.00 },  // Reserve price at 220,000 tokens
                                { x: 90000, y: 1.45 }    // Trigger price at 90,000 tokens
                            ],
                            backgroundColor: [
                                'rgba(0, 123, 255, 0.8)',  // Current price (blue)
                                'rgba(40, 167, 69, 0.8)',  // Reserve price (green)
                                'rgba(220, 53, 69, 0.8)'   // Trigger price (red)
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            pointRadius: 10,
                            pointStyle: ['circle', 'triangle', 'rect'],
                            showLine: false,
                            pointHoverRadius: 12,
                            pointHoverBackgroundColor: [
                                'rgba(0, 123, 255, 1)',  // Current price (blue)
                                'rgba(40, 167, 69, 1)',  // Reserve price (green)
                                'rgba(220, 53, 69, 1)'   // Trigger price (red)
                            ],
                            pointHoverBorderColor: '#ffffff',
                            pointHoverBorderWidth: 3
                        }
                    ]
                };

                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Cumulative Demand (Tokens)'
                            },
                            type: 'linear',
                            position: 'bottom',
                            min: 0,
                            max: 290000
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price ($)'
                            },
                            min: 0,
                            max: 3
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                },
                                filter: function(item) {
                                    // Hide the "Key Price Points" label from the legend
                                    return item.text !== 'Key Price Points';
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const datasetIndex = context.datasetIndex;
                                    const dataIndex = context.dataIndex;
                                    
                                    // Special handling for key price points
                                    if (context.dataset.label === 'Key Price Points') {
                                        if (dataIndex === 0) {
                                            return `Current Price: $${context.raw.y}`;
                                        } else if (dataIndex === 1) {
                                            return `Reserve Price: $${context.raw.y}`;
                                        } else if (dataIndex === 2) {
                                            return `Trigger Price: $${context.raw.y}`;
                                        }
                                    }
                                    
                                    return `${context.dataset.label}: $${context.raw}`;
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                reservePriceLine: {
                                    type: 'line',
                                    yMin: 1.50,
                                    yMax: 1.50,
                                    borderColor: 'rgba(40, 167, 69, 0.8)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        enabled: true,
                                        content: 'Reserve Price: $1.50',
                                        position: 'end',
                                        backgroundColor: 'rgba(40, 167, 69, 0.8)',
                                        font: {
                                            weight: 'bold'
                                        }
                                    }
                                },
                                currentPriceLine: {
                                    type: 'line',
                                    yMin: 1.75,
                                    yMax: 1.75,
                                    borderColor: 'rgba(0, 123, 255, 0.8)',
                                    borderWidth: 2,
                                    borderDash: [2, 2],
                                    label: {
                                        enabled: true,
                                        content: 'Current Price: $1.75',
                                        position: 'end',
                                        backgroundColor: 'rgba(0, 123, 255, 0.8)',
                                        font: {
                                            weight: 'bold'
                                        }
                                    }
                                },
                                triggerPriceLine: {
                                    type: 'line',
                                    yMin: 1.85,
                                    yMax: 1.85,
                                    borderColor: 'rgba(220, 53, 69, 0.8)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        enabled: true,
                                        content: 'Trigger Price: $1.85',
                                        position: 'end',
                                        backgroundColor: 'rgba(220, 53, 69, 0.8)',
                                        font: {
                                            weight: 'bold'
                                        }
                                    }
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Round 3 Cumulative Demand Curve',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        subtitle: {
                            display: true,
                            text: 'Token allocation with reserve, current, and trigger price thresholds',
                            font: {
                                size: 14,
                                style: 'italic'
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                };

                // Create chart container dynamically
                const centerPanel = document.querySelector('.center-panel');
                const chartCard = document.createElement('div');
                chartCard.className = 'panel-card';
                chartCard.innerHTML = `
                    <div class="panel-card-title">
                        <span>Cumulative Demand Analysis</span>
                        <span class="chart-subtitle" style="font-size: 0.8rem; font-weight: normal; color: var(--text-secondary);">Price distribution based on token demand</span>
                    </div>
                    <div class="chart-container" style="position: relative; height: 400px; margin-top: 10px;">
                        <canvas id="roundChart"></canvas>
                    </div>
                    <div class="chart-description" style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                        This graph shows the cumulative demand curve for the current auction round. 
                        The colored areas represent different allocation tiers, and the curve indicates 
                        price sensitivity at various demand levels.
                    </div>
                `;
                centerPanel.appendChild(chartCard);

                // Initialize the chart
                const ctx = document.getElementById('roundChart').getContext('2d');
                const roundChart = new Chart(ctx, {
                    type: 'line',
                    data: round3Data,
                    options: chartOptions
                });
                
                // Update chart when timeline steps are clicked
                timelineSteps.forEach(step => {
                    step.addEventListener('click', () => {
                        const round = parseInt(step.getAttribute('data-round'));
                        let chartData;
                        
                        // Update chart title based on selected round
                        chartOptions.plugins.title.text = `Round ${round} Cumulative Demand Curve`;
                        
                        switch(round) {
                            case 1:
                                chartData = round1Data;
                                break;
                            case 3:
                                chartData = round3Data;
                                break;
                            default:
                                // Use a placeholder data for other rounds
                                chartData = {
                                    labels: Array.from({length: 30}, (_, i) => i * 10000),
                                    datasets: [
                                        // Normal allocation
                                        {
                                            label: 'Normal',
                                            data: generateAreaData(3.00, 2.00, 0, 6),
                                            backgroundColor: 'rgba(0, 123, 255, 0.5)',
                                            borderWidth: 0,
                                            fill: true,
                                            pointRadius: 0
                                        },
                                        // Prior Round allocation
                                        {
                                            label: 'Prior Round',
                                            data: generateAreaData(2.00, 1.85, 6, 8),
                                            backgroundColor: 'rgba(255, 193, 7, 0.5)',
                                            borderWidth: 0,
                                            fill: true,
                                            pointRadius: 0
                                        },
                                        // Future Round allocation
                                        {
                                            label: 'Future Round',
                                            data: generateAreaData(1.85, 1.75, 8, 10),
                                            backgroundColor: 'rgba(40, 167, 69, 0.5)',
                                            borderWidth: 0,
                                            fill: true,
                                            pointRadius: 0
                                        },
                                        // Not Cleared allocation
                                        {
                                            label: 'Not Cleared',
                                            data: generateAreaData(1.75, 0.75, 10, 30),
                                            backgroundColor: 'rgba(220, 53, 69, 0.5)',
                                            borderWidth: 0,
                                            fill: true,
                                            pointRadius: 0
                                        },
                                        // Demand Curve line
                                        {
                                            label: 'Demand Curve',
                                            data: [3.00, 2.80, 2.60, 2.40, 2.20, 2.00, 1.90, 1.85, 1.80, 1.75, 1.70, 1.65, 1.60, 1.55, 1.50, 1.45, 1.40, 1.35, 1.30, 1.25, 1.20, 1.15, 1.10, 1.05, 1.00, 0.95, 0.90, 0.85, 0.80, 0.75],
                                            borderColor: 'rgb(220, 53, 69)',
                                            borderWidth: 3,
                                            tension: 0.1,
                                            fill: false
                                        },
                                        // Add key point markers
                                        {
                                            label: `Round ${round} Key Points`,
                                            data: [
                                                { x: 90000, y: 1.75 },
                                                { x: 150000, y: 1.50 }
                                            ],
                                            backgroundColor: `rgb(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255})`,
                                            borderColor: '#ffffff',
                                            borderWidth: 2,
                                            pointRadius: 10,
                                            pointStyle: 'rectRot',
                                            showLine: false,
                                            pointHoverRadius: 12
                                        }
                                    ]
                                };
                        }
                        
                        roundChart.data = chartData;
                        roundChart.update();
                    });
                });
            }

            // Call the function to initialize graphs
            initializeRoundGraphs();
            
            // Simple bid calculations
            const simpleBidAmount = document.getElementById('simple-bid-amount');
            const simpleMaxPrice = document.getElementById('simple-max-price');
            const simpleEstimatedTokens = document.getElementById('simple-estimated-tokens');
            const simpleDiscount = document.getElementById('simple-discount');
            const simpleTotal = document.getElementById('simple-total');
            
            function updateSimpleBidCalculations() {
                const bidAmount = parseFloat(simpleBidAmount.value) || 0;
                const maxPrice = parseFloat(simpleMaxPrice.value) || 0;
                
                if (bidAmount > 0 && maxPrice > 0) {
                    const estimatedTokens = Math.floor(bidAmount / maxPrice);
                    const discountAmount = bidAmount * 0.05; // 5% early bid discount
                    
                    simpleEstimatedTokens.textContent = estimatedTokens.toLocaleString();
                    simpleDiscount.textContent = `$${discountAmount.toFixed(2)}`;
                    simpleTotal.textContent = `$${bidAmount.toFixed(2)}`;
                } else {
                    simpleEstimatedTokens.textContent = '0';
                    simpleDiscount.textContent = '$0.00';
                    simpleTotal.textContent = '$0.00';
                }
            }
            
            simpleBidAmount.addEventListener('input', updateSimpleBidCalculations);
            simpleMaxPrice.addEventListener('input', updateSimpleBidCalculations);
            
            // Advanced bid calculations
            const advancedTokenAmount = document.getElementById('advanced-token-amount');
            const minPrice = document.getElementById('min-price');
            const maxPrice = document.getElementById('max-price');
            const advTotalAmount = document.getElementById('adv-total-amount');
            const advDiscount = document.getElementById('adv-discount');
            const advProbability = document.getElementById('adv-probability');
            const advFinalAmount = document.getElementById('adv-final-amount');
            
            function updateAdvancedBidCalculations() {
                const tokenAmount = parseInt(advancedTokenAmount.value) || 0;
                const maxPriceValue = parseFloat(maxPrice.value) || 0;
                
                if (tokenAmount > 0 && maxPriceValue > 0) {
                    const totalAmount = maxPriceValue * tokenAmount;
                    const discountAmount = totalAmount * 0.05; // 5% early bid discount
                    const finalAmount = totalAmount - discountAmount;
                    
                    // Calculate probability based on price (simple algorithm for demo)
                    let probability = "High";
                    if (maxPriceValue >= 1.55) {
                        probability = "Very High (95%)";
                    } else if (maxPriceValue >= 1.45) {
                        probability = "High (80%)";
                    } else if (maxPriceValue >= 1.35) {
                        probability = "Medium (60%)";
                    } else {
                        probability = "Low (30%)";
                    }
                    
                    advTotalAmount.textContent = `$${totalAmount.toFixed(2)}`;
                    advDiscount.textContent = `$${discountAmount.toFixed(2)}`;
                    advProbability.textContent = probability;
                    advFinalAmount.textContent = `$${finalAmount.toFixed(2)}`;
                } else {
                    advTotalAmount.textContent = '$0.00';
                    advDiscount.textContent = '$0.00';
                    advProbability.textContent = 'N/A';
                    advFinalAmount.textContent = '$0.00';
                }
            }
            
            advancedTokenAmount.addEventListener('input', updateAdvancedBidCalculations);
            minPrice.addEventListener('input', updateAdvancedBidCalculations);
            maxPrice.addEventListener('input', updateAdvancedBidCalculations);
            
            // Initialize calculations
            updateSimpleBidCalculations();
            updateAdvancedBidCalculations();
            
            // Sell tokens preview calculations
            const sellTokenAmount = document.getElementById('sell-token-amount');
            const sellMinPrice = document.getElementById('sell-min-price');
            const sellTokensPreview = document.getElementById('sell-tokens-preview');
            const sellPricePreview = document.getElementById('sell-price-preview');
            const sellAvgCost = document.getElementById('sell-avg-cost');
            const sellPnlPerToken = document.getElementById('sell-pnl-per-token');
            const sellTotalAmount = document.getElementById('sell-total-amount');
            const sellTotalPnl = document.getElementById('sell-total-pnl');
            
            function updateSellTokensPreview() {
                const tokenAmount = parseInt(sellTokenAmount.value) || 0;
                const minPrice = parseFloat(sellMinPrice.value) || 0;
                const avgCost = 1.41; // From portfolio data
                
                if (tokenAmount > 0 && minPrice > 0) {
                    // Calculate P&L per token
                    const pnlPerToken = minPrice - avgCost;
                    const totalAmount = minPrice * tokenAmount;
                    const totalPnl = pnlPerToken * tokenAmount;
                    
                    // Update preview elements
                    sellTokensPreview.textContent = tokenAmount.toLocaleString();
                    sellPricePreview.textContent = `$${minPrice.toFixed(2)}`;
                    sellAvgCost.textContent = `$${avgCost.toFixed(2)}`;
                    
                    // Set P&L color based on profit or loss
                    if (pnlPerToken >= 0) {
                        sellPnlPerToken.textContent = `+$${pnlPerToken.toFixed(2)}`;
                        sellPnlPerToken.style.color = '#28a745'; // Green for profit
                        sellTotalPnl.textContent = `+$${totalPnl.toFixed(2)}`;
                        sellTotalPnl.style.color = '#28a745';
                    } else {
                        sellPnlPerToken.textContent = `-$${Math.abs(pnlPerToken).toFixed(2)}`;
                        sellPnlPerToken.style.color = '#dc3545'; // Red for loss
                        sellTotalPnl.textContent = `-$${Math.abs(totalPnl).toFixed(2)}`;
                        sellTotalPnl.style.color = '#dc3545';
                    }
                    
                    sellTotalAmount.textContent = `$${totalAmount.toFixed(2)}`;
                } else {
                    // Reset preview if inputs are invalid
                    sellTokensPreview.textContent = '0';
                    sellPricePreview.textContent = minPrice > 0 ? `$${minPrice.toFixed(2)}` : '$0.00';
                    sellAvgCost.textContent = `$${avgCost.toFixed(2)}`;
                    sellPnlPerToken.textContent = '$0.00';
                    sellPnlPerToken.style.color = 'inherit';
                    sellTotalAmount.textContent = '$0.00';
                    sellTotalPnl.textContent = '$0.00';
                    sellTotalPnl.style.color = 'inherit';
                }
            }
            
            // Add event listeners for sell tokens inputs
            sellTokenAmount.addEventListener('input', updateSellTokensPreview);
            sellMinPrice.addEventListener('input', updateSellTokensPreview);
            
            // Initialize sell tokens preview
            updateSellTokensPreview();
            
            // Auction rules toggle
            const complianceTitle = document.querySelector('.compliance-title');
            const complianceContent = document.querySelector('.compliance-content');
            
            complianceTitle.addEventListener('click', function() {
                const isVisible = complianceContent.style.display !== 'none';
                complianceContent.style.display = isVisible ? 'none' : 'block';
                complianceTitle.querySelector('span:last-child').textContent = isVisible ? '+' : '-';
            });
        });
    </script>
    
    <!-- Chart initialization script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize price curve chart
            const priceCurveCanvas = document.getElementById('priceCurveChart');
            if (priceCurveCanvas) {
                const ctx = priceCurveCanvas.getContext('2d');
                
                // Get current date and calculate auction times
                const now = new Date();
                const auctionStart = new Date(now);
                auctionStart.setHours(now.getHours() - 6); // Assuming we're halfway through a 12-hour auction
                
                // Generate time labels for the x-axis (actual times)
                const timeLabels = [];
                for (let i = 0; i <= 12; i += 2) {
                    const labelTime = new Date(auctionStart);
                    labelTime.setHours(auctionStart.getHours() + i);
                    timeLabels.push(labelTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}));
                }
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timeLabels,
                        datasets: [
                            {
                                label: 'Auction Price Curve',
                                data: [1.50, 1.58, 1.65, 1.75, 1.85, 1.92, 2.00], // Reversed to slope from low to high
                                borderColor: '#f6d131',
                                backgroundColor: 'rgba(246, 209, 49, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4,
                                pointBackgroundColor: '#f6d131'
                            },
                            {
                                label: 'Reserve Price',
                                data: [1.50, 1.50, 1.50, 1.50, 1.50, 1.50, 1.50],
                                borderColor: 'rgba(40, 167, 69, 0.8)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'Current Price',
                                data: [1.75, 1.75, 1.75, 1.75, 1.75, 1.75, 1.75],
                                borderColor: 'rgba(0, 123, 255, 0.8)',
                                borderWidth: 2,
                                borderDash: [2, 2],
                                fill: false,
                                pointRadius: 0
                            },
                            {
                                label: 'Trigger Price',
                                data: [1.85, 1.85, 1.85, 1.85, 1.85, 1.85, 1.85],
                                borderColor: 'rgba(220, 53, 69, 0.8)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Price: $${context.raw}`;
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Round 3 Auction Price Dynamics',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            },
                            subtitle: {
                                display: true,
                                text: 'Price changes over auction duration with key price thresholds',
                                font: {
                                    size: 12,
                                    style: 'italic'
                                },
                                padding: {
                                    bottom: 10
                                }
                            },
                            annotation: {
                                annotations: {
                                    reservePriceLine: {
                                        type: 'line',
                                        xMin: 0,
                                        xMax: 0,
                                        borderColor: 'rgba(40, 167, 69, 0.8)',
                                        borderWidth: 2,
                                        borderDash: [5, 5],
                                        label: {
                                            enabled: true,
                                            content: 'Reserve Price: $1.50',
                                            position: 'top',
                                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                                            font: {
                                                weight: 'bold'
                                            }
                                        }
                                    },
                                    currentPriceLine: {
                                        type: 'line',
                                        xMin: 4,
                                        xMax: 4,
                                        borderColor: 'rgba(0, 123, 255, 0.8)',
                                        borderWidth: 2,
                                        borderDash: [2, 2],
                                        label: {
                                            enabled: true,
                                            content: 'Current Price: $1.75',
                                            position: 'top',
                                            backgroundColor: 'rgba(0, 123, 255, 0.8)'
                                        }
                                    },
                                    triggerPriceLine: {
                                        type: 'line',
                                        xMin: 6,
                                        xMax: 6,
                                        borderColor: 'rgba(220, 53, 69, 0.8)',
                                        borderWidth: 2,
                                        borderDash: [5, 5],
                                        label: {
                                            enabled: true,
                                            content: 'Trigger Price: $1.85',
                                            position: 'top',
                                            backgroundColor: 'rgba(220, 53, 69, 0.8)'
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 1.45,
                                max: 2.05,
                                title: {
                                    display: true,
                                    text: 'Token Price ($)',
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Auction Time',
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Initialize bid volume heatmap
            const bidHeatmapCanvas = document.getElementById('bidHeatmapChart');
            if (bidHeatmapCanvas) {
                const ctx = bidHeatmapCanvas.getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['$1.50-1.55', '$1.56-1.60', '$1.61-1.65', '$1.66-1.70', '$1.71-1.75', '$1.76-1.80', '$1.81-1.85', '$1.86-1.90', '$1.91-2.00'],
                        datasets: [
                            {
                                label: 'Low Volume (< 15k tokens)',
                                data: [8000, 15000, 0, 0, 0, 0, 0, 12000, 6000],
                                backgroundColor: 'rgba(246, 209, 49, 0.2)',
                                borderColor: 'rgba(246, 209, 49, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Medium Volume (15k-30k tokens)',
                                data: [0, 0, 22000, 0, 0, 0, 20000, 0, 0],
                                backgroundColor: 'rgba(246, 209, 49, 0.5)',
                                borderColor: 'rgba(246, 209, 49, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'High Volume (> 30k tokens)',
                                data: [0, 0, 0, 38000, 45000, 32000, 0, 0, 0],
                                backgroundColor: 'rgba(246, 209, 49, 0.8)',
                                borderColor: 'rgba(246, 209, 49, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Volume: ${context.raw.toLocaleString()} tokens`;
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Bid Distribution by Price Range',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            },
                            annotation: {
                                annotations: {
                                    reservePriceLine: {
                                        type: 'line',
                                        xMin: 0,
                                        xMax: 0,
                                        borderColor: 'rgba(40, 167, 69, 0.8)',
                                        borderWidth: 2,
                                        borderDash: [5, 5],
                                        label: {
                                            enabled: true,
                                            content: 'Reserve Price: $1.50',
                                            position: 'top',
                                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                                            font: {
                                                weight: 'bold'
                                            }
                                        }
                                    },
                                    currentPriceLine: {
                                        type: 'line',
                                        xMin: 4,
                                        xMax: 4,
                                        borderColor: 'rgba(0, 123, 255, 0.8)',
                                        borderWidth: 2,
                                        borderDash: [2, 2],
                                        label: {
                                            enabled: true,
                                            content: 'Current Price: $1.75',
                                            position: 'top',
                                            backgroundColor: 'rgba(0, 123, 255, 0.8)'
                                        }
                                    },
                                    triggerPriceLine: {
                                        type: 'line',
                                        xMin: 6,
                                        xMax: 6,
                                        borderColor: 'rgba(220, 53, 69, 0.8)',
                                        borderWidth: 2,
                                        borderDash: [5, 5],
                                        label: {
                                            enabled: true,
                                            content: 'Trigger Price: $1.85',
                                            position: 'top',
                                            backgroundColor: 'rgba(220, 53, 69, 0.8)'
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                stacked: true
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Volume (tokens)'
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html> 